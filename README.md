# computeWindowTolerance โ ูุญุงุณุจูโฺฏุฑ ุชููุฑุงูุณ ูพูุฌุฑู

ุงุจุฒุงุฑ ูุจ ุจุฑุง **ุซุจุช ุงูุฏุงุฒูโูุง ูพูุฌุฑู ุจูโุตูุฑุช ุณูโููุทูโุง** (ุนุฑุถ: ุจุงูุง/ูุณุท/ูพุงู ู ุงุฑุชูุงุน: ฺูพ/ูุณุท/ุฑุงุณุช)ุ ูุญุงุณุจูโ ุฎูุฏฺฉุงุฑ **ุชููุฑุงูุณ/ุงุนูุฌุงุฌ**ุ ฺฏุฒุงุฑุด ูุถุนุช **ูุจูู/ูุดุฏุงุฑ/ูุฑุฏูุฏ** ู ุฎุฑูุฌ **Excel** ุญุฑููโุง.

> Frontend-only (ุจุฏูู ุจฺฉโุงูุฏ). ุณุงุฎุชูโุดุฏู ุจุง **Vite + React + TypeScript + Tailwind + shadcn/ui** ู **lucide-react**. ุฎุฑูุฌ Excel ุจุง **ExcelJS** (ูุณุฎู ุดฺฉ) ู **SheetJS (XLSX)** (ูุณุฎู ุณุงุฏู) ูพุดุชุจุงู ูโุดูุฏ.

---

## ููุฑุณุช ูุทุงูุจ
- [ูฺฺฏโูุง](#ูฺฺฏูุง)
- [ููุง ฺฉู](#ููุง-ฺฉู)
- [ุงูฺฏูุฑุชู ูุญุงุณุจุงุช ุชููุฑุงูุณ](#ุงูฺฏูุฑุชู-ูุญุงุณุจุงุช-ุชููุฑุงูุณ)
- [ุณุงุฎุชุงุฑ ูพุฑูฺู](#ุณุงุฎุชุงุฑ-ูพุฑูฺู)
- [ุฑุงูโุงูุฏุงุฒ](#ุฑุงูุงูุฏุงุฒ)
- [ุงุณฺฉุฑูพุชโูุง](#ุงุณฺฉุฑูพุชูุง)
- [ุฎุฑูุฌ Excel](#ุฎุฑูุฌ-excel)
- [ูุฏู ุฏุงุฏู](#ูุฏู-ุฏุงุฏู)
- [ฺฉุงููพูููุชโูุง ฺฉูุฏ](#ฺฉุงููพูููุชูุง-ฺฉูุฏ)
- [ฺฉูุช ฺฉุฏ](#ฺฉูุช-ฺฉุฏ)
- [ูฺฉุงุช UI/UX](#ูฺฉุงุช-uiux)
- [ููุดูโุฑุงู](#ููุดูุฑุงู)
- [ุนุจโุงุจ](#ุนุจุงุจ)
- [ูุฌูุฒ](#ูุฌูุฒ)

---

## ูฺฺฏโูุง

- ๐ฏ **ูุฑูุฏ ุฏุงุฏูู ุณูโููุทูโุง** ุจุฑุง ูุฑ ูพูุฌุฑู
  - ุนุฑุถ: ุจุงูุง / ูุณุท / ูพุงู
  - ุงุฑุชูุงุน: ฺูพ / ูุณุท / ุฑุงุณุช
- ๐ **ุญุฏ ุชููุฑุงูุณ (LIMIT)** ุงุฎุชุตุงุต ุจุฑุง ูุฑ ูพูุฌุฑู + ุถุฑุจ ูุดุฏุงุฑ ูุงุจูโุชูุธู
- ๐งฎ **ูุญุงุณุจุงุช ุฎูุฏฺฉุงุฑ** ูุงูฺฏูโูุงุ ุฑูุฌโูุงุ ูุทุฑ ูุธุฑ/ูุงูุนุ ุงุฎุชูุงู ูุทุฑ ู ุชููุฑุงูุณโูุง
- โ ูุถุนุช ููุง: **pass / warning / fail**
- ๐ **ุตูุญู ฺฏุฒุงุฑุด ู ูููุฏุงุฑูุง**
- ๐ค **ุฎุฑูุฌ Excel**
  - ูุณุฎูโ **ExcelJS**: ุดุชโูุง ุงุณุชุงูโุฏุงุฑุ ุฑุงุณุชโุจูโฺูพุ ุฑูฺฏ ูุถุนุชุ ุนุฑุถ ุณุชููโูุงุ ูุฑูุช ุงุนุฏุงุฏุ ููุชุฑ ุฎูุงุตู.
  - ูุณุฎูโ **SheetJS (XLSX)**: ุฎุฑูุฌ ุณุจฺฉ ู ุณุฑุน
- ๐งญ **Flow ุณูโูุฑุญููโุง**: ุงุทูุงุนุงุช ูพุฑูฺู โ ูุฑูุฏ ุฏุงุฏู โ ฺฏุฒุงุฑุด/ุฏุงูููุฏ
- ๐ **RTL** ู ุณุงุฒฺฏุงุฑ ุจุง ุชู ุฑูุดู/ุชุงุฑฺฉ
- ๐งฉ TypeScript ฺฉุงูู (ุจุฏูู any) + ESLint/Prettier

---

## ููุง ฺฉู

1) ฺฉุงุฑุจุฑ ุงุทูุงุนุงุช ูพุฑูฺู ุฑุง ูุงุฑุฏ ูโฺฉูุฏ.  
2) ุทุจูุงุช ุฑุง ูโุณุงุฒุฏ ู ุจุฑุง ูุฑ ุทุจูู ูพูุฌุฑูโูุง ุฑุง ุจุง ุงูุฏุงุฒูโูุง ุณูโููุทูโุง + LIMIT ุซุจุช ูโฺฉูุฏ.  
3) ุณุณุชู ุจุง ูุฑููู ุงุณุชุงูุฏุงุฑุฏุ ุฎุทุงูุง/ุงุนูุฌุงุฌ ุฑุง ูุญุงุณุจู ู ูุถุนุช ุฑุง ูุดุฎุต ูโฺฉูุฏ.  
4) ฺฏุฒุงุฑุด ูุถุนุช ู ุฎุฑูุฌ Excel ุฏุฑ ุงุฎุชุงุฑ ฺฉุงุฑุจุฑ ูุฑุงุฑ ูโฺฏุฑุฏ.

---

## ุงูฺฏูุฑุชู ูุญุงุณุจุงุช ุชููุฑุงูุณ

**ูุฑูุฏโูุง**  
- ุนุฑุถโูุง: `Wtop, Wmid, Wbot`  
- ุงุฑุชูุงุนโูุง: `Hleft, Hmid, Hright`  
- ุงุจุนุงุฏ ุงุณู: `W0, H0`  
- ุญุฏ ูุฌุงุฒ: `T` (LIMIT) ู ุถุฑุจ ูุดุฏุงุฑ `k` (ูพุดโูุฑุถ 1.5)

**ูุงูฺฏูโูุง**
```
Wฬ = (Wtop + Wmid + Wbot) / 3
Hฬ = (Hleft + Hmid + Hright) / 3
```

**ุฑูุฌโูุง (ุงุนูุฌุงุฌ ููุทุน)**
```
RangeW = max(W*) - min(W*)
RangeH = max(H*) - min(H*)
```

**ุชููุฑุงูุณ ุงุจุนุงุฏ ูุณุจุช ุจู ุงุณู**
```
TolW = | Wฬ - W0 |
TolH = | Hฬ - H0 |
```

**ูุทุฑ ูุธุฑ/ูุงูุน ู ุงุฎุชูุงู**
```
Dth  = sqrt(W0^2 + H0^2)
Dact = sqrt(Wฬ^2 + Hฬ^2)
ฮD   = | Dact - Dth |
```

**ูุงููู ูพุฐุฑุด**
```
PASS    : TolW โค T  โง  TolH โค T  โง  ฮD โค T  โง  RangeW โค 2T  โง  RangeH โค 2T
WARNING : ููุงู ุดุฑูุท ุจุง k*T (ู ุญุฏุงูู ฺฉ > T)
FAIL    : ุบุฑ ุงุฒ ุฏู ุญุงูุช ุจุงูุง
```

**ุงุณฺฉุงูุฑ ุชุฑฺฉุจ (ุงุฎุชุงุฑ)**
```
ฮ = max( TolW, TolH, ฮD, RangeW/2, RangeH/2 )
```

**ูพุงุฏูโุณุงุฒ ูุฑุฌุน**: [`src/utils/computeWindowTolerance.ts`](src/utils/computeWindowTolerance.ts)

---

## ุณุงุฎุชุงุฑ ูพุฑูฺู

```
src/
  components/
    floor/FloorManager.tsx          # ูุฏุฑุช ุทุจูุงุช + ูุฑู ูุฑูุฏ ูพูุฌุฑู
    charts/ChartContainer.tsx       # ูููุฏุงุฑูุง/ฺฏุฒุงุฑุด
    layout/Header.tsx               # ูุฏุฑ + ุฏฺฉูู ุฏุงูููุฏ
    project/ProjectInfoForm.tsx     # ูุฑู ุงุทูุงุนุงุช ูพุฑูฺู
  hooks/
    useFloorsData.ts                # ููุทู ู ูุฏู ูพูุฌุฑูโูุง + ูุญุงุณุจุงุช ูุดุชูโุดุฏู
    useProjectInfo.ts               # ูุถุนุช/ูุฑู ูพุฑูฺู
    useExcelExport.ts               # ูุงุณุท ุฎุฑูุฌ Excel (ExcelJS)
  utils/
    computeWindowTolerance.ts       # ูุฑููู ุชููุฑุงูุณ ุณูโููุทูโุง
    export/exceljs-export.ts        # ุฎุฑูุฌ Excel ุดฺฉ (ExcelJS)
    tolerance/                      # ุฎุฑูุฌ ุณุงุฏู (SheetJS) + ุชุงูพโูุง/ฺฉุงูุณ
  types/                            # ุชุงูพโูุง ุนููู (ุฏุฑ ุตูุฑุช ูุฌูุฏ)
  pages/
    Index.tsx                       # ุตูุญู ุงุตู (3 ูุฑุญูู)
```

---

## ุฑุงูโุงูุฏุงุฒ

### ูพุดโูุงุฒูุง
- Node.js 18+
- npm ุง pnpm

### ูุตุจ ู ุงุฌุฑุง
```bash
# ูุตุจ
npm i

# ุงุฌุฑุง ุฏุฑ ุญุงูุช ุชูุณุนู
npm run dev

# ุณุงุฎุช ูุณุฎู ุชููุฏ
npm run build

# ูพุดโููุงุด ุชููุฏ
npm run preview

# ุจุฑุฑุณ ฺฉุฏ ุจุง ESLint
npm run lint
```

---

## ุงุณฺฉุฑูพุชโูุง

| ุงุณฺฉุฑูพุช | ุชูุถุญ |
|---|---|
| `dev` | ุงุฌุฑุง ูุญุท ุชูุณุนู Vite |
| `build` | ุณุงุฎุช ุจุงูุฏู ุชููุฏ |
| `preview` | ูพุดโููุงุด ุจุงูุฏู ุชููุฏ |
| `lint` | ุงุฌุฑุง ESLint ุจุง ููุงูู TypeScript |
| `format` | (ุฏุฑ ุตูุฑุช ุชุนุฑู) ุงุฌุฑุง Prettier |

---

## ุฎุฑูุฌ Excel

### ExcelJS (ุชุฑุฌุญ)
- ูุงู: [`src/utils/export/exceljs-export.ts`](src/utils/export/exceljs-export.ts)
- ุงูฺฉุงูุงุช: ุฑุงุณุชโุจูโฺูพุ ุงุณุชุงู ูุฏุฑุ ุฑูฺฏ ูุถุนุช (ูุจูู/ูุดุฏุงุฑ/ูุฑุฏูุฏ)ุ ุนุฑุถ ุณุชููโูุงุ ูุฑูุช ุงุนุฏุงุฏุ ููุชุฑ ุฎูุงุตู.
- ุงุณุชูุงุฏู:
```ts
import { useExcelExport } from "@/hooks/useExcelExport";
const { exportToExcel } = useExcelExport();
exportToExcel(projectInfo, floors);
```

### SheetJS (ุณุงุฏู)
- ูุงู: [`src/utils/tolerance/excel.ts`](src/utils/tolerance/excel.ts)
- ุฎุฑูุฌ ุณุฑุน ุจุง ุฌุฏููโูุง ุณุงุฏู (ุจุฏูู ุงุณุชุงู ุฑูฺฏ).

---

## ูุฏู ุฏุงุฏู

### WindowInput
```ts
interface WindowInput {
  code: string;
  nominalWidth: number;
  nominalHeight: number;
  limit: number;
  widthTop: number; widthMiddle: number; widthBottom: number;
  heightLeft: number; heightMiddle: number; heightRight: number;
}
```

### WindowItem (ูุดุชูโุดุฏู)
```ts
interface WindowItem extends WindowInput {
  id: string; floorId: string;
  widthMean: number; heightMean: number;
  widthRange: number; heightRange: number;
  theoreticalDiagonal: number; actualDiagonal: number; diagonalDiff: number;
  widthTolerance: number; heightTolerance: number;
  status: 'pass' | 'warning' | 'fail';
}
```

### FloorItem
```ts
interface FloorItem {
  id: string;
  name?: string;
  floorNumber: number;
  windows: WindowItem[];
}
```

---

## ฺฉุงููพูููุชโูุง ฺฉูุฏ

- **FloorManager**: ูุฑู ูุฑูุฏ ูพูุฌุฑู ุจุง ูุจูโูุง ูุงุถุญุ ุงุนุชุจุงุฑุณูุฌ ููุฏูุงุชุ ูุณุช ูพูุฌุฑูโูุง ุทุจูู.
- **Header**: ุดุงูู ุฏฺฉููโ ุฏุงูููุฏ Excel ฺฉู ุจู `useExcelExport` ูุชุตู ุงุณุช.
- **ChartContainer**: ููุงุด ุขูุงุฑ/ูููุฏุงุฑูุง (ุฏุฑ ุตูุฑุช ุงุณุชูุงุฏู ุงุฒ ุชุงูพโูุง ูุฏูุ ุขุฏุงูพุชูุฑ ุฏุฑ `Index.tsx`).

---

## ฺฉูุช ฺฉุฏ

- TypeScript ููุ ุจุฏูู `any` (ููุงูู `@typescript-eslint/no-explicit-any` ูพุงุณ ูโุดูุฏ).
- ESLint + Prettier (ูุงุจู ุณูุงุฑุดโุณุงุฒ).
- ูพูุดูโุจูุฏ ูุงฺููุงุฑ ู ูุงุจู ูฺฏูุฏุงุฑ.

---

## ูฺฉุงุช UI/UX

- ุฑุงุณุชโุจูโฺูพุ ูุงุจูโุฎูุงูุฏู ุฏุฑ ูุฑ ุฏู ุชู ุฑูุดู/ุชุงุฑฺฉ.
- ุงุณุชูุงุฏู ุงุฒ ุชูฺฉูโูุง ุนููู shadcn/ui: `bg-muted`, `text-muted-foreground`, `border` ูโฆ
- ฺฉุงูโุงูุช ุฑุงูููุง ุจุง ูุฑุฒุจูุฏ ู ูพุณโุฒูููโ ููุงู (ููููู ุฏุฑ `Index.tsx`).

---

## ููุดูโุฑุงู

- [ ] ุฐุฎุฑูโุณุงุฒ Local/Cloud
- [ ] ุงูุฒูุฏู ููฺฏู ุจู ExcelJS ู Freeze Header
- [ ] Pivot ุฎูุงุตูโุขูุงุฑ ุฏุฑ Excel
- [ ] ุชุณุช ูุงุญุฏ ุจุฑุง ูุฑููู `computeWindowTolerance`
- [ ] ฺูุฏุฒุจุงููโุณุงุฒ (i18n) ู English UI

---

## ุนุจโุงุจ

- **ุฏุงูููุฏ ุงฺฉุณู ฺฉุงุฑ ููโฺฉูุฏ**: ูุทูุฆู ุดูุฏ `useExcelExport` ุจู `Header` ูุตู ุงุณุช ู `projectInfo` ู `floors` ููุฏุงุฑ ุฏุงุฑูุฏ. ุฏุฑ ฺฉูุณูู ุฎุทุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ.
- **ุฑูฺฏ/ูพุณโุฒูููโ ุฑุงูููุง ุณูุฏ ุงุณุช**: ุงุฒ `bg-muted/50` ู `text-muted-foreground` ุงุณุชูุงุฏู ฺฉูุฏ ุง ุชูฺฉูโูุง ุณูุงุฑุด ุฑุง ุฏุฑ `tailwind.config.js` ุชุนุฑู ฺฉูุฏ.
- **ุงุฑูุฑ ESLint ุฏุฑุจุงุฑู any**: ูุณุฎูโูุง ููุง `useExcelExport.ts` ู `Index.tsx` ุจุฏูู any ูุณุชูุฏุ ุญุชูุงู ุฌุงฺฏุฒู ุดููุฏ.
- **ูุงุณุงุฒฺฏุงุฑ ExcelJS properties**: ุงุฒ `wb.creator/created/...` ุงุณุชูุงุฏู ฺฉูุฏุ `wb.properties.title` ููฺฉู ุงุณุช ุฏุฑ ุชุงูพ ูุณุฎู ุดูุง ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏ.

---

## ูุฌูุฒ

ุงู ูพุฑูฺู ุชุญุช ูุฌูุฒ MIT ููุชุดุฑ ูโุดูุฏ (ุฏุฑ ุตูุฑุช ูุงุฒ ุชุบุฑ ุฏูุฏ).

---

### ุงุฏุฏุงุดุช ุชูุณุนู
ุงฺฏุฑ ูุงุฒ ุฏุงุฑุฏ ุชููุฑุงูุณ ุฑุง ูุฒู ฺฉูุฏ (ุญุณุงุณุช ุจุดุชุฑ ุจู ุฑูุฌโูุง ุง ุงุฎุชูุงู ูุทุฑ)ุ ุฏุฑ `computeWindowTolerance` ุจูโุณุงุฏฺฏ ูโุชูุงู ุถุฑุงุจ ูุฒู ุงูุฒูุฏ ู ุขุณุชุงููโูุง ุฑุง ุชุทุจู ุฏุงุฏ.
